<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>인천공항 운항 정보</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js" onload="console.log('Babel loaded')" onerror="console.error('Babel failed to load')"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body class="bg-slate-900 text-white">
    <div id="root"></div>

    <script type="text/babel">
        // Check if Babel is loaded
        if (typeof Babel === 'undefined') {
            console.error('Babel is not loaded');
            document.getElementById('root').innerHTML = '<div style="padding: 20px; color: red;">Babel 라이브러리를 로드할 수 없습니다.</div>';
        }
        
        const { useState, useEffect, useCallback, useMemo } = React;

        // Types (converted to constants)
        const TERMINALS = [
            { id: 'P01', name: '1터미널', gateStart: 1, gateEnd: 50 },
            { id: 'P02', name: '탑승동', gateStart: 101, gateEnd: 132 },
            { id: 'P03', name: '2터미널', gateStart: 208, gateEnd: 291 },
        ];

        const EXCLUDED_GATES = new Set([4, 13, 44, 120, 226, 227, 228, 229, 244, 271, 272, 273]);

        const GATE_API_URL = 'https://corsproxy.io/?' + encodeURIComponent('http://apis.data.go.kr/B551177/StatusOfPassengerFlightsDSOdp/getPassengerDeparturesDSOdp?serviceKey=6uC38lshDqWE5U0LuYIGHZ3XeIIEocXrQmhXd11WEmLFLh5ygZSG%2FPNeYov0pyzTU99ISscjIZIp%2FL%2FE2oI%2FYA%3D%3D&type=xml');

        const COUNTER_API_URL = 'https://corsproxy.io/?' + encodeURIComponent('http://apis.data.go.kr/B551177/StatusOfPassengerFlightsDeOdp/getPassengerDeparturesDeOdp?serviceKey=6uC38lshDqWE5U0LuYIGHZ3XeIIEocXrQmhXd11WEmLFLh5ygZSG%2FPNeYov0pyzTU99ISscjIZIp%2FL%2FE2oI%2FYA%3D%3D&type=xml');

        const Page = {
            Main: 0,
            GateUsage: 1,
            GateInfo: 2,
            EmptyGates: 3,
            CounterInfoTerminalSelect: 4,
            CounterInfoT1: 5,
            CounterInfoT2: 6,
        };

        // Service functions
        const parseFlightsFromXML = (xmlText) => {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
            const items = xmlDoc.getElementsByTagName('item');
            const flights = [];

            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                const gatenumber = item.querySelector('gatenumber')?.textContent?.trim() ?? '';
                const chkinrange = item.querySelector('chkinrange')?.textContent?.trim() ?? '';

                if ((gatenumber && gatenumber !== '-') || (chkinrange && chkinrange !== '---')) {
                    flights.push({
                        gatenumber: gatenumber === '-' ? '' : gatenumber,
                        flightId: item.querySelector('flightId')?.textContent ?? '',
                        scheduleDateTime: item.querySelector('scheduleDateTime')?.textContent ?? '',
                        terminalid: item.querySelector('terminalid')?.textContent ?? '',
                        remark: item.querySelector('remark')?.textContent ?? null,
                        airline: item.querySelector('airline')?.textContent ?? '',
                        estimateDateTime: item.querySelector('estimateDateTime')?.textContent ?? null,
                        chkinrange: chkinrange === '---' ? null : chkinrange,
                        airportkor: item.querySelector('airportkor')?.textContent ?? '',
                    });
                }
            }
            return flights;
        };

        const deDuplicateFlights = (flights) => {
            const seen = new Set();
            const uniqueFlights = [];
            for (const flight of flights) {
                const key = `${flight.flightId}:${flight.scheduleDateTime}:${flight.gatenumber}:${flight.chkinrange}`;
                if (!seen.has(key)) {
                    uniqueFlights.push(flight);
                    seen.add(key);
                }
            }
            return uniqueFlights;
        };

        const formatDate = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        };

        const fetchFlightData = async () => {
            try {
                const today = new Date();
                const tomorrow = new Date();
                tomorrow.setDate(today.getDate() + 1);

                const todayStr = formatDate(today);
                const tomorrowStr = formatDate(tomorrow);
                
                const fetchGateToday = fetch(`${GATE_API_URL}&selectdate=${todayStr}&from_time=0000&to_time=2359`).then(res => res.text());
                const fetchGateTomorrow = fetch(`${GATE_API_URL}&selectdate=${tomorrowStr}&from_time=0000&to_time=2359`).then(res => res.text());
                const fetchCounterToday = fetch(`${COUNTER_API_URL}&selectdate=${todayStr}&from_time=0000&to_time=2359`).then(res => res.text());
                const fetchCounterTomorrow = fetch(`${COUNTER_API_URL}&selectdate=${tomorrowStr}&from_time=0000&to_time=2359`).then(res => res.text());

                const responses = await Promise.all([
                    fetchGateToday,
                    fetchGateTomorrow,
                    fetchCounterToday,
                    fetchCounterTomorrow
                ]);

                const allFlights = responses.flatMap(xml => parseFlightsFromXML(xml));
                return deDuplicateFlights(allFlights).sort((a, b) => a.scheduleDateTime.localeCompare(b.scheduleDateTime));

            } catch (error) {
                console.error('Failed to fetch flight data:', error);
                throw error;
            }
        };

        // Helper Components
        const LoadingSpinner = () => (
            <div className="flex justify-center items-center h-full">
                <div className="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-500"></div>
            </div>
        );

        const Header = ({ onBack, title }) => (
            <header className="bg-slate-800 p-4 flex items-center shadow-lg sticky top-0 z-10">
                {onBack && (
                    <button onClick={onBack} className="text-cyan-400 text-2xl mr-4 hover:text-cyan-300" aria-label="Go back">
                        &#8592;
                    </button>
                )}
                <h1 className="text-xl font-bold text-white">{title}</h1>
            </header>
        );

        const FlightCard = ({ flight }) => {
            const formatTime = (dateTime) => {
                if (dateTime.length !== 12) return dateTime;
                return `${dateTime.substring(8, 10)}:${dateTime.substring(10, 12)}`;
            };

            const statusColor = (remark) => {
                if (!remark) return 'text-gray-400';
                if (remark.includes('출발') || remark.includes('Departed')) return 'text-green-400';
                if (remark.includes('지연') || remark.includes('Delayed')) return 'text-yellow-400';
                if (remark.includes('취소') || remark.includes('Cancelled')) return 'text-red-400';
                return 'text-cyan-400';
            };

            return (
                <div className="bg-slate-800 rounded-lg p-4 mb-3 shadow-md border-l-4 border-cyan-500">
                    <div className="flex justify-between items-center">
                        <span className="text-lg font-bold text-white">{flight.flightId}</span>
                        <span className={`text-lg font-semibold ${statusColor(flight.remark)}`}>{flight.remark || '확인중'}</span>
                    </div>
                    <div className="mt-2 text-slate-300">
                        <p>예정 시간: <span className="font-mono">{formatTime(flight.scheduleDateTime)}</span></p>
                    </div>
                </div>
            );
        };

        const CounterFlightCard = ({ flight }) => {
            const formatTime = (dateTime) => {
                if (!dateTime || dateTime.length < 12) return '';
                return `${dateTime.substring(8, 10)}:${dateTime.substring(10, 12)}`;
            };

            const statusColor = (remark) => {
                if (!remark) return 'text-gray-400';
                if (remark.includes('출발') || remark.includes('Departed')) return 'text-green-400';
                if (remark.includes('지연') || remark.includes('Delayed')) return 'text-yellow-400';
                if (remark.includes('취소') || remark.includes('Cancelled')) return 'text-red-400';
                return 'text-cyan-400';
            };

            const scheduledTime = formatTime(flight.scheduleDateTime);
            const estimatedTime = formatTime(flight.estimateDateTime);

            return (
                <div className="bg-slate-800 rounded-lg p-4 mb-3 shadow-md border-l-4 border-indigo-500">
                    <div className="flex justify-between items-start">
                        <div>
                            <span className="text-sm text-slate-400">{flight.airline}</span>
                            <h3 className="text-lg font-bold text-white">
                                {flight.flightId}
                                <span className="text-base font-normal text-slate-300 ml-2">{flight.airportkor}</span>
                            </h3>
                        </div>
                        <div className="text-right">
                            <p className="text-lg font-mono text-white">
                                {estimatedTime && scheduledTime !== estimatedTime && <span className="line-through text-slate-400 mr-2">{scheduledTime}</span>}
                                <span>{estimatedTime || scheduledTime}</span>
                            </p>
                            <span className={`text-sm font-semibold ${statusColor(flight.remark)}`}>{flight.remark || '확인중'}</span>
                        </div>
                    </div>
                    <div className="mt-2 text-slate-300">
                        <p>체크인카운터: <span className="font-mono bg-slate-700 px-2 py-1 rounded">{flight.chkinrange}</span></p>
                    </div>
                </div>
            );
        };

        // Screen Components
        const MainScreen = ({ onNavigate }) => {
            return (
                <div className="flex flex-col h-screen">
                    <Header title="인천공항 운항 정보" />
                    <main className="flex-grow p-5 flex flex-col justify-center gap-6">
                        <button
                            onClick={() => onNavigate(Page.CounterInfoTerminalSelect)}
                            className="p-10 rounded-lg text-2xl font-bold transition-all duration-200 shadow-xl bg-indigo-600 text-white hover:bg-indigo-500"
                        >
                            카운터 배정정보
                        </button>
                        <button
                            onClick={() => onNavigate(Page.GateUsage)}
                            className="p-10 rounded-lg text-2xl font-bold transition-all duration-200 shadow-xl bg-teal-600 text-white hover:bg-teal-500"
                        >
                            탑승구 사용정보
                        </button>
                    </main>
                </div>
            );
        };

        const GateUsageScreen = ({ selectedTerminal, onSelectTerminal, onNavigate, onBack }) => {
            const handleTerminalSelect = (terminal) => {
                onSelectTerminal(selectedTerminal?.id === terminal.id ? null : terminal);
            };
            
            return (
                <div className="flex flex-col h-screen">
                    <Header onBack={onBack} title="탑승구 사용정보" />
                    <main className="flex-grow p-5 flex flex-col justify-center">
                        <div className="grid grid-cols-3 gap-3 mb-4">
                            {TERMINALS.map((terminal) => (
                                <button key={terminal.id} onClick={() => handleTerminalSelect(terminal)}
                                    className={`p-6 rounded-lg text-lg font-semibold transition-all duration-200 shadow-lg ${
                                        selectedTerminal?.id === terminal.id
                                            ? 'bg-cyan-500 text-white ring-2 ring-cyan-300'
                                            : 'bg-slate-800 text-slate-300 hover:bg-slate-700'
                                    }`}
                                >
                                    {terminal.name}
                                </button>
                            ))}
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <button onClick={() => onNavigate(Page.GateInfo)} disabled={!selectedTerminal} className="p-8 rounded-lg text-xl font-bold transition-all duration-200 shadow-xl bg-sky-600 text-white disabled:bg-slate-700 disabled:text-slate-500 hover:enabled:bg-sky-500">
                                탑승구별 조회
                            </button>
                            <button onClick={() => onNavigate(Page.EmptyGates)} disabled={!selectedTerminal} className="p-8 rounded-lg text-xl font-bold transition-all duration-200 shadow-xl bg-emerald-600 text-white disabled:bg-slate-700 disabled:text-slate-500 hover:enabled:bg-emerald-500">
                                미사용 탑승구
                            </button>
                        </div>
                    </main>
                </div>
            );
        };

        const CounterInfoTerminalSelectScreen = ({ onNavigate, onBack }) => {
            return (
                <div className="flex flex-col h-screen">
                    <Header onBack={onBack} title="카운터 정보 - 터미널 선택" />
                    <main className="flex-grow p-5 flex flex-col justify-center gap-6">
                        <button
                            onClick={() => onNavigate(Page.CounterInfoT1)}
                            className="p-10 rounded-lg text-2xl font-bold transition-all duration-200 shadow-xl bg-cyan-600 text-white hover:bg-cyan-500"
                        >
                            1 터미널
                        </button>
                        <button
                            onClick={() => onNavigate(Page.CounterInfoT2)}
                            className="p-10 rounded-lg text-2xl font-bold transition-all duration-200 shadow-xl bg-emerald-600 text-white hover:bg-emerald-500"
                        >
                            2 터미널
                        </button>
                    </main>
                </div>
            );
        };

        const parseCounterRange = (rangeStr) => {
            const cleanedStr = rangeStr.replace(/\s/g, '').toUpperCase();
            const match = cleanedStr.match(/^([A-Z])(\d{1,2})(?:-([A-Z])?(\d{1,2}))?$/);
            if (!match) return null;

            const letter1 = match[1];
            const startNum = parseInt(match[2], 10);
            const letter2 = match[3];
            const endNumStr = match[4];

            if (letter2 && letter1 !== letter2) return null;
            
            const endNum = endNumStr ? parseInt(endNumStr, 10) : startNum;
            return { letter: letter1, start: Math.min(startNum, endNum), end: Math.max(startNum, endNum) };
        };

        const CounterInfoScreen = ({ allFlights, onBack, terminalId, terminalName, counterLetters, excludedZones }) => {
            const [selectedZone, setSelectedZone] = useState(null);
            const [filteredFlights, setFilteredFlights] = useState([]);

            const zones = useMemo(() => 
                counterLetters.flatMap(letter => [`${letter}-1`, `${letter}-2`]).filter(zone => !excludedZones.has(zone)),
            [counterLetters, excludedZones]);

            const handleZoneSelect = useCallback((zone) => {
                setSelectedZone(zone);
                const [zoneLetter, zoneNum] = zone.split('-');
                const zoneStart = zoneNum === '1' ? 1 : 19;
                const zoneEnd = zoneNum === '1' ? 18 : 36;

                const flightsInZone = allFlights
                    .filter(f => {
                        if (f.terminalid !== terminalId || !f.chkinrange) return false;
                        
                        const flightCounterRange = parseCounterRange(f.chkinrange);
                        if (!flightCounterRange || flightCounterRange.letter !== zoneLetter) return false;

                        const overlap = zoneStart <= flightCounterRange.end && flightCounterRange.start <= zoneEnd;
                        return overlap;
                    })
                    .sort((a, b) => a.scheduleDateTime.localeCompare(b.scheduleDateTime));
                
                const uniqueFlights = [];
                const seenCounters = new Set();

                for (const flight of flightsInZone) {
                    if (flight.chkinrange) {
                        const key = `${flight.chkinrange}:${flight.scheduleDateTime}`;
                        if (!seenCounters.has(key)) {
                            uniqueFlights.push(flight);
                            seenCounters.add(key);
                        }
                    }
                }
                
                setFilteredFlights(uniqueFlights);
            }, [allFlights, terminalId]);

            return (
                <div className="flex flex-col h-screen">
                    <Header onBack={onBack} title={`${terminalName} 카운터 존 선택`} />
                    <div className="p-4 overflow-y-auto flex-grow">
                        <div className="grid grid-cols-4 gap-2">
                            {zones.map(zone => (
                                <button
                                    key={zone}
                                    onClick={() => handleZoneSelect(zone)}
                                    className={`p-3 rounded font-mono text-center transition-colors ${selectedZone === zone ? 'bg-indigo-500 text-white' : 'bg-slate-800 hover:bg-slate-700'}`}
                                >
                                    {zone}
                                </button>
                            ))}
                        </div>

                        {selectedZone && (
                            <div className="mt-6">
                                <h2 className="text-xl font-bold mb-4 text-indigo-400 border-b-2 border-slate-700 pb-2">
                                    {selectedZone} Zone 운항 정보
                                </h2>
                                {filteredFlights.length > 0 ? (
                                    filteredFlights.map((flight) => <CounterFlightCard key={`${flight.flightId}-${flight.scheduleDateTime}-${flight.chkinrange}`} flight={flight} />)
                                ) : (
                                    <p className="text-slate-400 text-center mt-8">해당 존에 배정된 운항편이 없습니다.</p>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const GateInfoScreen = ({ allFlights, terminal, onBack }) => {
            const [selectedGate, setSelectedGate] = useState(null);

            const terminalFlights = useMemo(() => 
                allFlights.filter(f => f.terminalid === terminal.id),
            [allFlights, terminal.id]);

            const gateFlights = useMemo(() => {
                if (!selectedGate) return [];
                
                const flightsForGate = terminalFlights.filter(f => f.gatenumber === selectedGate);
                const uniqueFlightsByTime = [];
                const seenTimes = new Set();

                for (const flight of flightsForGate) {
                    if (!seenTimes.has(flight.scheduleDateTime)) {
                        uniqueFlightsByTime.push(flight);
                        seenTimes.add(flight.scheduleDateTime);
                    }
                }
                return uniqueFlightsByTime;
            }, [terminalFlights, selectedGate]);
            
            const gates = useMemo(() => {
                const gateList = [];
                const padLength = terminal.id === 'P01' ? 2 : 3;
                for (let i = terminal.gateStart; i <= terminal.gateEnd; i++) {
                    if (!EXCLUDED_GATES.has(i)) {
                        gateList.push(String(i).padStart(padLength, '0'));
                    }
                }
                return gateList.sort();
            }, [terminal]);

            return (
                <div className="flex flex-col h-screen">
                    <Header onBack={onBack} title={`${terminal.name} - 탑승구 선택`} />
                    <div className="p-4 overflow-y-auto flex-grow">
                        <div className="grid grid-cols-4 sm:grid-cols-5 gap-2">
                            {gates.map((gate) => (
                                <button
                                    key={gate}
                                    onClick={() => setSelectedGate(gate)}
                                    className={`p-2 rounded font-mono text-center transition-colors ${selectedGate === gate ? 'bg-cyan-500 text-white' : 'bg-slate-800 hover:bg-slate-700'}`}
                                >
                                    {gate}
                                </button>
                            ))}
                        </div>
                        {selectedGate && (
                            <div className="mt-6">
                                <h2 className="text-xl font-bold mb-4 text-cyan-400 border-b-2 border-slate-700 pb-2">
                                    Gate {selectedGate} 운항 정보
                                </h2>
                                {gateFlights.length > 0 ? (
                                    gateFlights.map((flight) => <FlightCard key={flight.flightId + flight.scheduleDateTime} flight={flight} />)
                                ) : (
                                    <p className="text-slate-400 text-center mt-8">해당 탑승구에 예정된 운항편이 없습니다.</p>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const EmptyGateScreen = ({ allFlights, terminal, onBack }) => {
            const [nHours, setNHours] = useState(3);
            const [showNumPad, setShowNumPad] = useState(false);
            const [emptyGates, setEmptyGates] = useState([]);
            const [nextFlight, setNextFlight] = useState(null);
            const [searched, setSearched] = useState(false);

            const searchEmptyGates = useCallback(() => {
                const now = new Date();
                const searchUntil = new Date(now.getTime() + nHours * 60 * 60 * 1000);
                
                const formatForCompare = (date) => {
                    return `${date.getFullYear()}${String(date.getMonth() + 1).padStart(2, '0')}${String(date.getDate()).padStart(2, '0')}${String(date.getHours()).padStart(2, '0')}${String(date.getMinutes()).padStart(2, '0')}`;
                };
                
                const nowStr = formatForCompare(now);
                const untilStr = formatForCompare(searchUntil);

                const terminalFlights = allFlights.filter(f => f.terminalid === terminal.id);
                const busyGates = new Set();

                terminalFlights.forEach(flight => {
                    if (flight.scheduleDateTime >= nowStr && flight.scheduleDateTime <= untilStr) {
                        busyGates.add(flight.gatenumber);
                    }
                });

                const allTerminalGates = [];
                const padLength = terminal.id === 'P01' ? 2 : 3;
                for (let i = terminal.gateStart; i <= terminal.gateEnd; i++) {
                    if (!EXCLUDED_GATES.has(i)) {
                        allTerminalGates.push(String(i).padStart(padLength, '0'));
                    }
                }

                const availableGates = allTerminalGates.filter(gate => !busyGates.has(gate));
                setEmptyGates(availableGates);
                setNextFlight(null);
                setSearched(true);
            }, [nHours, allFlights, terminal]);

            const showNextFlight = (gate) => {
                const now = new Date();
                const nowStr = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}`;
                
                const next = allFlights
                    .filter(f => f.gatenumber === gate && f.scheduleDateTime > nowStr)
                    .sort((a, b) => a.scheduleDateTime.localeCompare(b.scheduleDateTime))[0];
                setNextFlight(next || null);
            };

            return (
                <div className="flex flex-col h-screen">
                    <Header onBack={onBack} title={`${terminal.name} - 미사용 탑승구`} />
                    <div className="p-4 flex-grow overflow-y-auto">
                        <div className="bg-slate-800 p-4 rounded-lg flex items-center justify-between mb-4">
                            <div className="text-lg">
                                <button onClick={() => setShowNumPad(!showNumPad)} className="bg-cyan-600 rounded-full w-10 h-10 text-xl font-bold mr-3 hover:bg-cyan-500">{nHours}</button>
                                <span className="font-semibold">시간동안 운행 없음</span>
                            </div>
                            <button onClick={searchEmptyGates} className="bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-indigo-500">검색</button>
                        </div>

                        {showNumPad && (
                            <div className="grid grid-cols-5 gap-2 mb-4 p-3 bg-slate-700 rounded-lg">
                                {Array.from({ length: 10 }, (_, i) => i + 1).map(num => (
                                    <button key={num} onClick={() => { setNHours(num); setShowNumPad(false); }} className="p-3 bg-slate-800 rounded hover:bg-cyan-500">{num}</button>
                                ))}
                            </div>
                        )}
                        
                        {searched && (
                            <>
                                <h3 className="text-lg font-semibold mb-2 text-cyan-400">검색 결과 ({emptyGates.length}개)</h3>
                                {emptyGates.length > 0 ? (
                                    <div className="grid grid-cols-4 sm:grid-cols-5 gap-2">
                                        {emptyGates.map(gate => (
                                            <button key={gate} onClick={() => showNextFlight(gate)} className="p-2 rounded font-mono text-center bg-slate-700 hover:bg-slate-600">
                                                {gate}
                                            </button>
                                        ))}
                                    </div>
                                ) : (
                                    <p className="text-slate-400 text-center mt-4">검색 조건에 맞는 탑승구가 없습니다.</p>
                                )}
                            </>
                        )}

                        {nextFlight && (
                            <div className="mt-6">
                                <h3 className="text-lg font-semibold mb-2 text-cyan-400">Gate {nextFlight.gatenumber} 다음 운항편</h3>
                                <FlightCard flight={nextFlight} />
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const [page, setPage] = useState(Page.Main);
            const [selectedTerminal, setSelectedTerminal] = useState(null);
            const [flights, setFlights] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                const loadData = async () => {
                    try {
                        setLoading(true);
                        const data = await fetchFlightData();
                        setFlights(data);
                    } catch (err) {
                        setError('운항 정보를 불러오는 데 실패했습니다.');
                    } finally {
                        setLoading(false);
                    }
                };
                loadData();
            }, []);

            const displayFlights = useMemo(() => {
                if (!flights.length) return [];

                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowStr = `${tomorrow.getFullYear()}${String(tomorrow.getMonth() + 1).padStart(2, '0')}${String(tomorrow.getDate()).padStart(2, '0')}`;
                const tomorrowNineAm = `${tomorrowStr}0900`;

                return flights.filter(f => f.scheduleDateTime <= tomorrowNineAm);
            }, [flights]);

            const goBack = () => {
                switch (page) {
                    case Page.GateUsage:
                    case Page.CounterInfoTerminalSelect:
                        setPage(Page.Main);
                        break;
                    case Page.GateInfo:
                    case Page.EmptyGates:
                        setPage(Page.GateUsage);
                        break;
                    case Page.CounterInfoT1:
                    case Page.CounterInfoT2:
                        setPage(Page.CounterInfoTerminalSelect);
                        break;
                    default:
                        setPage(Page.Main);
                }
            };

            const renderContent = () => {
                if (loading) return <LoadingSpinner />;
                if (error) return <p className="text-center text-red-500 p-8">{error}</p>;

                const counterLetters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'J', 'K', 'L', 'M', 'N'];

                switch (page) {
                    case Page.GateUsage:
                        return <GateUsageScreen selectedTerminal={selectedTerminal} onSelectTerminal={setSelectedTerminal} onNavigate={setPage} onBack={goBack} />;
                    case Page.GateInfo:
                        return <GateInfoScreen allFlights={displayFlights} terminal={selectedTerminal} onBack={goBack} />;
                    case Page.EmptyGates:
                        return <EmptyGateScreen allFlights={displayFlights} terminal={selectedTerminal} onBack={goBack} />;
                    case Page.CounterInfoTerminalSelect:
                        return <CounterInfoTerminalSelectScreen onNavigate={setPage} onBack={goBack} />;
                    case Page.CounterInfoT1:
                        return <CounterInfoScreen
                            allFlights={displayFlights}
                            onBack={goBack}
                            terminalId="P01"
                            terminalName="T1"
                            counterLetters={counterLetters}
                            excludedZones={new Set(['A-2', 'G-2', 'N-2', 'A-1', 'B-1', 'B-2', 'C-1', 'C-2', 'G-1', 'L-1', 'L-2'])} />;
                    case Page.CounterInfoT2:
                        return <CounterInfoScreen
                            allFlights={displayFlights}
                            onBack={goBack}
                            terminalId="P03"
                            terminalName="T2"
                            counterLetters={counterLetters}
                            excludedZones={new Set(['A-2', 'F-2', 'G-2', 'N-2', 'A-1', 'B-1', 'B-2', 'C-1', 'C-2', 'D-1', 'D-2', 'F-1', 'G-1'])} />;
                    case Page.Main:
                    default:
                        return <MainScreen onNavigate={setPage} />;
                }
            };
            
            return (
                <div className="max-w-md mx-auto bg-slate-900 min-h-screen font-sans shadow-2xl">
                    {renderContent()}
                </div>
            );
        };

        // Render the app
        const initApp = () => {
            console.log('Initializing app...');
            console.log('React available:', typeof React !== 'undefined');
            console.log('ReactDOM available:', typeof ReactDOM !== 'undefined');
            
            const rootElement = document.getElementById('root');
            if (!rootElement) {
                console.error('Root element not found');
                document.body.innerHTML = '<div style="padding: 20px; color: red;">Root element를 찾을 수 없습니다.</div>';
                return;
            }
            
            if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                console.error('React or ReactDOM not loaded');
                rootElement.innerHTML = '<div style="padding: 20px; color: red;">React 라이브러리를 로드할 수 없습니다. 인터넷 연결을 확인하세요.</div>';
                return;
            }
            
            try {
                console.log('Creating root...');
                const root = ReactDOM.createRoot(rootElement);
                console.log('Rendering App component...');
                root.render(React.createElement(App));
                console.log('App rendered successfully');
            } catch (error) {
                console.error('Error rendering app:', error);
                rootElement.innerHTML = '<div style="padding: 20px; color: red;">앱을 로드하는 중 오류가 발생했습니다: ' + error.message + '</div>';
            }
        };

        // Wait for everything to be ready
        const checkAndInit = () => {
            if (typeof React !== 'undefined' && typeof ReactDOM !== 'undefined' && document.getElementById('root')) {
                initApp();
            } else {
                setTimeout(checkAndInit, 100);
            }
        };

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', checkAndInit);
        } else {
            checkAndInit();
        }
    </script>
</body>
</html>
